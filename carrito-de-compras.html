<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Carrito de Compras</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="style1.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <script src="node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
    crossorigin="anonymous"></script>
</head>

<body>
  <div class="p-3 bg-secondary text-white text-center d-flex justify-content-center align-items-center gap-2">
    <image src="images/titulo.png" alt="Logo titulo" style="width: 100px; height: 100px"></image>
    <h1 id="Titulo">QUESO & SABOR.</h1>
  </div>
  <div id="navbar"></div>

  <section class="p-0">
    <nav aria-label="breadcrumb" class="mb-3 mt-0">
      <ol class="breadcrumb bg-black p-2">
        <li class="breadcrumb-item">
          <a class="text-white" href="website.html">Home</a>
        </li>
        <li class="breadcrumb-item active text-white" aria-current="page">Carrito de compras</li>
      </ol>
    </nav>
  </section>


  <div class="container-fluid my-5 px-5" style="min-height: 60vh">
    <h2 class="text-center mb-4">üõí Proceso de compra</h2>

    <div class="table-responsive">
      <table class="table table-bordered align-middle w-100">
        <thead class="table-dark text-white">
          <tr>
            <th>Producto</th>
            <th>Precio</th>
            <th>Cantidad</th>
            <th>Subtotal</th>
            <th>Acci√≥n</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Queso Gruyere</td>
            <td>$7.500</td>
            <td>
              <input type="number" class="form-control form-control-sm w-50" value="1" min="1" />
            </td>
            <td>$7.500</td>
            <td>
              <button class="btn btn-sm btn-outline-danger">Cancelar</button>
            </td>
          </tr>
          <tr>
            <td>Queso Raclette</td>
            <td>$10.000</td>
            <td>
              <input type="number" class="form-control form-control-sm w-50" value="2" min="1" />
            </td>
            <td>$20.000</td>
            <td>
              <button class="btn btn-sm btn-outline-danger">Cancelar</button>
            </td>
          </tr>
        </tbody>
        <tfoot class="table-primary">
          <tr>
            <td colspan="3" class="text-end fw-bold">Total:</td>
            <td colspan="2" class="fw-bold">$27.500</td>
          </tr>
        </tfoot>
      </table>
    </div>

    <!-- Botones de acci√≥n -->
    <div class="d-flex justify-content-between mt-4">
      <a href="#" class="btn btn-warning">üõçÔ∏è Continuar comprando</a>
      <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#confirmarPedidoModal">
        Confirmar pedido
      </button>
    </div>
  </div>
  <div class="modal fade" id="confirmarPedidoModal" tabindex="-1" aria-labelledby="confirmarPedidoLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header bg-success text-white">
          <h5 class="modal-title" id="confirmarPedidoLabel">
            Confirmaci√≥n de Pedido
          </h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
        </div>
        <div class="modal-body">
          <p>¬øEst√°s seguro que deseas confirmar el pedido?</p>
          <ul class="list-unstyled">
            <li><strong>Pedido N¬∞:</strong> 107</li>
            <li><strong>Cliente:</strong> Juan P√©rez</li>
            <li><strong>Direcci√≥n:</strong> Av. Las Condes 1234</li>
            <li><strong>Total:</strong> $15.200</li>
          </ul>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
            Volver al carrito
          </button>
          <a type="button" href="datos-tarjeta.html" class="btn btn-success">
            üí≥ Proceder al pago
          </a>
        </div>
      </div>
    </div>
  </div>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const tabla = document.querySelector("table");

      // Eliminar producto
      tabla.addEventListener("click", function (event) {
        if (event.target.classList.contains("btn-outline-danger")) {
          const fila = event.target.closest("tr");
          fila.remove();
          actualizarTotal();
        }
      });

      // Actualizar subtotal al cambiar cantidad
      tabla.addEventListener("input", function (event) {
        if (event.target.matches("input[type='number']")) {
          const fila = event.target.closest("tr");
          const precioTexto = fila.querySelector("td:nth-child(2)").textContent;
          const precio = parseInt(precioTexto.replace(/\D/g, ""));
          const cantidad = parseInt(event.target.value) || 1;
          const nuevoSubtotal = precio * cantidad;

          fila.querySelector("td:nth-child(4)").textContent = `$${nuevoSubtotal.toLocaleString("es-CL")}`;
          actualizarTotal();
        }
      });

      // Recalcular total
      function actualizarTotal() {
        const filas = tabla.querySelectorAll("tbody tr");
        let total = 0;

        filas.forEach(fila => {
          const subtotalTexto = fila.querySelector("td:nth-child(4)").textContent;
          const subtotal = parseInt(subtotalTexto.replace(/\D/g, ""));
          total += subtotal;
        });

        const totalCelda = tabla.querySelector("tfoot td.fw-bold:last-child");
        totalCelda.textContent = `$${total.toLocaleString("es-CL")}`;
      }
    });
    document.addEventListener("DOMContentLoaded", () => {
      const tabla = document.querySelector("table");
      const modal = document.getElementById("confirmarPedidoModal");

      modal.addEventListener("show.bs.modal", function (event) {
        const filasCarrito = tabla.querySelectorAll("tbody tr");

        if (filasCarrito.length === 0) {
          event.preventDefault(); // ‚ùå Impide que el modal se abra
          mostrarAlerta("Debe agregar al menos un producto para confirmar pedido");
        }
      });

      function mostrarAlerta(mensaje) {
        const contenedor = document.querySelector(".container-fluid.my-5.px-5");
        let alerta = contenedor.querySelector(".alert");

        if (alerta) alerta.remove();

        alerta = document.createElement("div");
        alerta.className = "alert alert-warning mt-3";
        alerta.textContent = mensaje;

        contenedor.insertBefore(alerta, contenedor.querySelector(".table-responsive"));

        setTimeout(() => alerta.remove(), 4000);
      }
    });



  </script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const carrito = JSON.parse(localStorage.getItem("carrito")) || [];
      const tbody = document.querySelector("table tbody");

      // Limpiar contenido est√°tico
      tbody.innerHTML = "";

      carrito.forEach(producto => {
        const fila = document.createElement("tr");
        fila.innerHTML = `
        <td>${producto.nombre}</td>
        <td>$${producto.precio.toLocaleString("es-CL")}</td>
        <td>
          <input type="number" class="form-control form-control-sm w-50" value="${producto.cantidad}" min="1" />
        </td>
        <td>$${producto.subtotal.toLocaleString("es-CL")}</td>
        <td>
          <button class="btn btn-sm btn-outline-danger">Cancelar</button>
        </td>
      `;
        tbody.appendChild(fila);
      });

      actualizarTotal(); // Recalcular total inicial

      // Actualizar subtotal y total al cambiar cantidad
      tbody.addEventListener("input", function (event) {
        if (event.target.matches("input[type='number']")) {
          const fila = event.target.closest("tr");
          const precioTexto = fila.querySelector("td:nth-child(2)").textContent;
          const precio = parseInt(precioTexto.replace(/\D/g, ""));
          const cantidad = parseInt(event.target.value) || 1;
          const nuevoSubtotal = precio * cantidad;

          fila.querySelector("td:nth-child(4)").textContent = `$${nuevoSubtotal.toLocaleString("es-CL")}`;
          actualizarTotal();
        }
      });

      // Eliminar producto
      tbody.addEventListener("click", function (event) {
        if (event.target.classList.contains("btn-outline-danger")) {
          const fila = event.target.closest("tr");
          const nombreProducto = fila.querySelector("td:first-child").textContent;

          // Eliminar del DOM
          fila.remove();

          // Eliminar del localStorage
          const nuevoCarrito = carrito.filter(p => p.nombre !== nombreProducto);
          localStorage.setItem("carrito", JSON.stringify(nuevoCarrito));

          actualizarTotal();
        }
      });

      function actualizarTotal() {
        const filas = tbody.querySelectorAll("tr");
        let total = 0;

        filas.forEach(fila => {
          const subtotalTexto = fila.querySelector("td:nth-child(4)").textContent;
          const subtotal = parseInt(subtotalTexto.replace(/\D/g, ""));
          total += subtotal;
        });

        const totalCelda = document.querySelector("tfoot td.fw-bold:last-child");
        totalCelda.textContent = `$${total.toLocaleString("es-CL")}`;
      }
    });
  </script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const tabla = document.querySelector("table");
      const modal = document.getElementById("confirmarPedidoModal");

      modal.addEventListener("show.bs.modal", function (event) {
        const filasCarrito = tabla.querySelectorAll("tbody tr");

        if (filasCarrito.length === 0) {
          event.preventDefault();
          mostrarAlerta("Debe agregar al menos un producto para confirmar pedido");
          return;
        }

        // ‚úÖ Actualizar el total en el modal
        const totalTexto = document.querySelector("tfoot td.fw-bold:last-child").textContent;
        const totalModal = modal.querySelector(".modal-body ul li:last-child");
        totalModal.innerHTML = `<strong>Total:</strong> ${totalTexto}`;
      });

      function mostrarAlerta(mensaje) {
        const contenedor = document.querySelector(".container-fluid.my-5.px-5");
        let alerta = contenedor.querySelector(".alert");

        if (alerta) alerta.remove();

        alerta = document.createElement("div");
        alerta.className = "alert alert-warning mt-3";
        alerta.textContent = mensaje;

        contenedor.insertBefore(alerta, contenedor.querySelector(".table-responsive"));

        setTimeout(() => alerta.remove(), 4000);
      }
    });

  </script>

  <script>
    fetch("navbar.html")
      .then(res => res.text())
      .then(data => {
        document.getElementById("navbar").innerHTML = data;
        actualizarContadorCarrito();
      });

    function actualizarContadorCarrito() {
      const carrito = JSON.parse(localStorage.getItem("carrito")) || [];
      const totalProductos = carrito.reduce((acc, p) => acc + p.cantidad, 0);

      const badge = document.querySelector(".navbar .badge.bg-danger");
      if (badge) {
        badge.textContent = totalProductos;
        badge.style.display = totalProductos > 0 ? "inline-block" : "none";
      }
    }
  </script>

</body>
<footer class="bg-black text-white mt-0">
  <div class="container-fluid py-4">
    <div class="row">
      <!-- Informaci√≥n de la empresa -->
      <div class="col-md-6 text-center text-md-start mb-3 mb-md-0">
        <h5>üßÄ Queso & Sabor</h5>
        <p class="mb-0">¬© 2025 Todos los derechos reservados.</p>
      </div>

      <!-- Enlaces r√°pidos -->
      <div class="col-md-6 text-center text-md-end">
        <a href="#" class="text-white me-3 text-decoration-none">Inicio</a>
        <a href="#" class="text-white me-3 text-decoration-none">Productos</a>
        <a href="#" class="text-white me-3 text-decoration-none">Contacto</a>
        <a href="#" class="text-white text-decoration-none">Despacho</a>
      </div>
    </div>
  </div>
</footer>

</html>